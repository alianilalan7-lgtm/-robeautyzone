{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/alianilalan/Desktop/%C4%B1robeautyzone/iro-beautyzone/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/supabase'\n\nif (!process.env.NEXT_PUBLIC_SUPABASE_URL) {\n    throw new Error('Missing env.NEXT_PUBLIC_SUPABASE_URL')\n}\nif (!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY) {\n    throw new Error('Missing env.NEXT_PUBLIC_SUPABASE_ANON_KEY')\n}\n\n// Create a single supabase client for interacting with your database\nexport const supabase = createClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n)\n\n/**\n * Admin client with Service Role Key (for secure operations like webhooks)\n * ONLY use this on the server-side!\n */\nexport const getAdminClient = () => {\n    if (!process.env.SUPABASE_SERVICE_ROLE_KEY) {\n        throw new Error('Missing env.SUPABASE_SERVICE_ROLE_KEY')\n    }\n\n    return createClient<Database>(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.SUPABASE_SERVICE_ROLE_KEY,\n        {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        }\n    )\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAGA;;AAGA;;AAKO,MAAM,WAAW,IAAA,gMAAY;AAS7B,MAAM,iBAAiB;IAC1B,IAAI,CAAC,QAAQ,GAAG,CAAC,yBAAyB,EAAE;QACxC,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,IAAA,gMAAY,gFAEf,QAAQ,GAAG,CAAC,yBAAyB,EACrC;QACI,MAAM;YACF,kBAAkB;YAClB,gBAAgB;QACpB;IACJ;AAER"}},
    {"offset": {"line": 74, "column": 0}, "map": {"version":3,"sources":["file:///Users/alianilalan/Desktop/%C4%B1robeautyzone/iro-beautyzone/lib/whatsapp.ts"],"sourcesContent":["export async function sendWhatsAppNotification(text: string) {\n    const phone = process.env.CALLMEBOT_PHONE\n    const apiKey = process.env.CALLMEBOT_API_KEY\n\n    if (!phone || !apiKey) {\n        console.warn('WhatsApp NOTIFICATION SKIPPED: Missing env vars')\n        return\n    }\n\n    try {\n        const url = `https://api.callmebot.com/whatsapp.php?phone=${phone}&text=${encodeURIComponent(text)}&apikey=${apiKey}`\n        const res = await fetch(url)\n\n        if (!res.ok) {\n            console.error('WhatsApp API Error:', await res.text())\n        } else {\n            console.log('WhatsApp notification sent')\n        }\n    } catch (error) {\n        console.error('WhatsApp Send Failed:', error)\n    }\n}\n\nexport function generateAppointmentMessage(appointment: any, serviceName: string) {\n    const date = new Date(appointment.startAt).toLocaleDateString('tr-TR')\n    const time = new Date(appointment.startAt).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' })\n    const confirmLink = `${process.env.NEXT_PUBLIC_BASE_URL}/api/appointments/confirm?token=${appointment.confirmationToken}&action=confirm`\n    const cancelLink = `${process.env.NEXT_PUBLIC_BASE_URL}/api/appointments/confirm?token=${appointment.confirmationToken}&action=cancel`\n\n    return `ðŸ“… *YENÄ° RANDEVU TALEBÄ°*\\n\\n` +\n        `ðŸ‘¤ MÃ¼ÅŸteri: ${appointment.customerName}\\n` +\n        `ðŸ“ž Tel: ${appointment.customerPhone}\\n` +\n        `ðŸ’… Hizmet: ${serviceName}\\n` +\n        `ðŸ“† Tarih: ${date} ${time}\\n\\n` +\n        `Onaylamak iÃ§in:\\n${confirmLink}\\n\\n` +\n        `Reddetmek iÃ§in:\\n${cancelLink}`\n}\n"],"names":[],"mappings":";;;;;;AAAO,eAAe,yBAAyB,IAAY;IACvD,MAAM,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACzC,MAAM,SAAS,QAAQ,GAAG,CAAC,iBAAiB;IAE5C,IAAI,CAAC,SAAS,CAAC,QAAQ;QACnB,QAAQ,IAAI,CAAC;QACb;IACJ;IAEA,IAAI;QACA,MAAM,MAAM,CAAC,6CAA6C,EAAE,MAAM,MAAM,EAAE,mBAAmB,MAAM,QAAQ,EAAE,QAAQ;QACrH,MAAM,MAAM,MAAM,MAAM;QAExB,IAAI,CAAC,IAAI,EAAE,EAAE;YACT,QAAQ,KAAK,CAAC,uBAAuB,MAAM,IAAI,IAAI;QACvD,OAAO;YACH,QAAQ,GAAG,CAAC;QAChB;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,yBAAyB;IAC3C;AACJ;AAEO,SAAS,2BAA2B,WAAgB,EAAE,WAAmB;IAC5E,MAAM,OAAO,IAAI,KAAK,YAAY,OAAO,EAAE,kBAAkB,CAAC;IAC9D,MAAM,OAAO,IAAI,KAAK,YAAY,OAAO,EAAE,kBAAkB,CAAC,SAAS;QAAE,MAAM;QAAW,QAAQ;IAAU;IAC5G,MAAM,cAAc,6DAAoC,gCAAgC,EAAE,YAAY,iBAAiB,CAAC,eAAe,CAAC;IACxI,MAAM,aAAa,6DAAoC,gCAAgC,EAAE,YAAY,iBAAiB,CAAC,cAAc,CAAC;IAEtI,OAAO,CAAC,4BAA4B,CAAC,GACjC,CAAC,YAAY,EAAE,YAAY,YAAY,CAAC,EAAE,CAAC,GAC3C,CAAC,QAAQ,EAAE,YAAY,aAAa,CAAC,EAAE,CAAC,GACxC,CAAC,WAAW,EAAE,YAAY,EAAE,CAAC,GAC7B,CAAC,UAAU,EAAE,KAAK,CAAC,EAAE,KAAK,IAAI,CAAC,GAC/B,CAAC,iBAAiB,EAAE,YAAY,IAAI,CAAC,GACrC,CAAC,iBAAiB,EAAE,YAAY;AACxC"}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///Users/alianilalan/Desktop/%C4%B1robeautyzone/iro-beautyzone/lib/appointments.ts"],"sourcesContent":["import { supabase } from './supabase'\nimport { z } from 'zod'\nimport { addMinutes, isBefore, isAfter, parse, format, getDay } from 'date-fns'\nimport { sendWhatsAppNotification, generateAppointmentMessage } from './whatsapp'\n\nexport const AppointmentSchema = z.object({\n    serviceId: z.string(),\n    customerName: z.string().min(2),\n    customerPhone: z.string().min(10),\n    customerEmail: z.string().email().optional().or(z.literal('')),\n    date: z.string(), // YYYY-MM-DD\n    time: z.string(), // HH:mm\n    kvkkConsent: z.boolean().refine(val => val === true, \"KVKK onayÄ± gereklidir\")\n})\n\nexport type CreateAppointmentInput = z.infer<typeof AppointmentSchema>\n\nexport async function checkAvailability(date: string, time: string, durationMin: number) {\n    const startAt = new Date(`${date}T${time}`)\n    const endAt = addMinutes(startAt, durationMin)\n\n    // 1. Check Business Hours\n    const dayOfWeek = format(startAt, 'EEEE').toUpperCase()\n    const { data: businessHours, error: bhError } = await supabase\n        .from('business_hours')\n        .select('*')\n        .eq('dayOfWeek', dayOfWeek)\n        .single()\n\n    if (bhError || !businessHours?.isOpen) {\n        return { available: false, reason: 'Ä°ÅŸ yeri kapalÄ±' }\n    }\n\n    // Convert \"09:00\" to comparison mechanism\n    const openTime = parse(`${date}T${businessHours.openTime}`, \"yyyy-MM-dd'T'HH:mm\", new Date())\n    const closeTime = parse(`${date}T${businessHours.closeTime}`, \"yyyy-MM-dd'T'HH:mm\", new Date())\n\n    if (isBefore(startAt, openTime) || isAfter(endAt, closeTime)) {\n        return { available: false, reason: 'Ã‡alÄ±ÅŸma saatleri dÄ±ÅŸÄ±nda' }\n    }\n\n    // 2. Check Closures (Holidays)\n    const { data: closure } = await supabase\n        .from('closures')\n        .select('id')\n        .eq('date', date)\n        .maybeSingle()\n\n    if (closure) {\n        return { available: false, reason: 'Bu tarihte kapalÄ±yÄ±z' }\n    }\n\n    // 3. Check Overlapping Appointments\n    // Overlap formula: (StartA < EndB) and (EndA > StartB)\n    const { data: conflicts, error: conflictError } = await supabase\n        .from('appointments')\n        .select('id')\n        .neq('status', 'CANCELED')\n        .neq('status', 'NO_RESPONSE')\n        .lt('startAt', endAt.toISOString())\n        .gt('endAt', startAt.toISOString())\n\n    if (conflictError) {\n        console.error('Conflict check error:', conflictError)\n        throw new Error('MÃ¼saitlik kontrolÃ¼ yapÄ±lamadÄ±')\n    }\n\n    if (conflicts && conflicts.length > 0) {\n        return { available: false, reason: 'SeÃ§ilen saat dolu' }\n    }\n\n    return { available: true }\n}\n\nexport async function createAppointment(input: CreateAppointmentInput) {\n    // 1. Get Service Details\n    const { data: service } = await supabase\n        .from('services')\n        .select('*')\n        .eq('slug', input.serviceId) // UI sends slug\n        .single()\n\n    if (!service) throw new Error('Hizmet bulunamadÄ±')\n\n    // 2. Check Availability\n    const check = await checkAvailability(input.date, input.time, service.durationMin)\n    if (!check.available) {\n        throw new Error(check.reason)\n    }\n\n    // 3. Calculate Timestamps\n    const startAt = new Date(`${input.date}T${input.time}`).toISOString()\n    const endAt = addMinutes(new Date(`${input.date}T${input.time}`), service.durationMin).toISOString()\n\n    // 4. Insert Appointment\n    const { data, error } = await supabase\n        .from('appointments')\n        .insert({\n            serviceId: service.id,\n            customerName: input.customerName,\n            customerPhone: input.customerPhone,\n            customerEmail: input.customerEmail || null,\n            startAt,\n            endAt,\n            status: 'PENDING_CONFIRMATION',\n            kvkkConsent: input.kvkkConsent,\n            consentAt: new Date().toISOString(),\n            confirmationToken: crypto.randomUUID()\n        })\n        .select()\n        .single()\n\n    if (error) {\n        console.error('Create error:', error)\n        throw new Error('Randevu oluÅŸturulamadÄ±')\n    }\n\n    // 5. Send Notification (Async - don't block response)\n    const message = generateAppointmentMessage(data, service.name)\n    sendWhatsAppNotification(message).catch(err => console.error('Notification failed:', err))\n\n    return data\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///Users/alianilalan/Desktop/%C4%B1robeautyzone/iro-beautyzone/app/api/slots/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { checkAvailability } from '@/lib/appointments'\nimport { addMinutes, format, isBefore, parse, set } from 'date-fns'\n\nexport async function GET(request: Request) {\n    const { searchParams } = new URL(request.url)\n    const date = searchParams.get('date')\n    const serviceSlug = searchParams.get('service')\n    const duration = searchParams.get('duration')\n\n    if (!date || !duration) {\n        return NextResponse.json({ error: 'Tarih ve sÃ¼re gereklidir' }, { status: 400 })\n    }\n\n    const durationMin = parseInt(duration)\n    const slots = []\n\n    // Start from 09:00 to 20:00 (simple loop, real logic uses business hours in checkAvailability)\n    // We generated logic in lib/appointments to check business hours, so we can just loop widely\n    // and let the checker filter them.\n\n    // But to be efficient, we should roughly know open hours.\n    // Let's assume 09:00 - 19:30 (last slot)\n\n    let current = parse(`${date}T09:00`, \"yyyy-MM-dd'T'HH:mm\", new Date())\n    const end = parse(`${date}T20:00`, \"yyyy-MM-dd'T'HH:mm\", new Date())\n\n    while (isBefore(current, end)) {\n        const timeStr = format(current, 'HH:mm')\n\n        // Skip past times if today\n        const now = new Date()\n        const slotDateTime = parse(`${date}T${timeStr}`, \"yyyy-MM-dd'T'HH:mm\", new Date())\n\n        if (isBefore(slotDateTime, now)) {\n            current = addMinutes(current, 30) // 30 min intervals\n            continue\n        }\n\n        const check = await checkAvailability(date, timeStr, durationMin)\n\n        if (check.available) {\n            slots.push(timeStr)\n        }\n\n        current = addMinutes(current, 30)\n    }\n\n    return NextResponse.json({ slots })\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAAA;AAAA;AAAA;;;;AAEO,eAAe,IAAI,OAAgB;IACtC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAC9B,MAAM,cAAc,aAAa,GAAG,CAAC;IACrC,MAAM,WAAW,aAAa,GAAG,CAAC;IAElC,IAAI,CAAC,QAAQ,CAAC,UAAU;QACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAClF;IAEA,MAAM,cAAc,SAAS;IAC7B,MAAM,QAAQ,EAAE;IAEhB,+FAA+F;IAC/F,6FAA6F;IAC7F,mCAAmC;IAEnC,0DAA0D;IAC1D,yCAAyC;IAEzC,IAAI,UAAU,IAAA,+JAAK,EAAC,GAAG,KAAK,MAAM,CAAC,EAAE,sBAAsB,IAAI;IAC/D,MAAM,MAAM,IAAA,+JAAK,EAAC,GAAG,KAAK,MAAM,CAAC,EAAE,sBAAsB,IAAI;IAE7D,MAAO,IAAA,qJAAQ,EAAC,SAAS,KAAM;QAC3B,MAAM,UAAU,IAAA,iKAAM,EAAC,SAAS;QAEhC,2BAA2B;QAC3B,MAAM,MAAM,IAAI;QAChB,MAAM,eAAe,IAAA,+JAAK,EAAC,GAAG,KAAK,CAAC,EAAE,SAAS,EAAE,sBAAsB,IAAI;QAE3E,IAAI,IAAA,qJAAQ,EAAC,cAAc,MAAM;YAC7B,UAAU,IAAA,yJAAU,EAAC,SAAS,KAAI,mBAAmB;YACrD;QACJ;QAEA,MAAM,QAAQ,MAAM,IAAA,0IAAiB,EAAC,MAAM,SAAS;QAErD,IAAI,MAAM,SAAS,EAAE;YACjB,MAAM,IAAI,CAAC;QACf;QAEA,UAAU,IAAA,yJAAU,EAAC,SAAS;IAClC;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE;IAAM;AACrC"}}]
}